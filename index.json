[{"content":"Topologi Penjelasan Promtail: Agen pengumpul log dari berbagai sumber seperti file teks, syslog, dan jurnal sistem kemudian mengirimkannya ke penyimpanan log yang disebut loki. Install promtail di setiap node atau vm yang ingin dipantau.\nLoki: Penyimpanan log yang dirancang untuk menyimpan dan mengindeks log secara efisien. Loki menggunakan struktur penyimpanan berbasis waktu yang disebut \u0026ldquo;index\u0026rdquo; dan \u0026ldquo;chunk\u0026rdquo;. Log yang dikumpulkan oleh promtail dikirim ke loki untuk disimpan.\nGrafana: berfungsi sebagai visualisasi jika ingin memonitoring jumlah log ataupun ingin menggunakan fitur grafana alert agar ketika ada log error maka akan mengirimkan notifikasi (optional).\nInstall Promtail Download package promtail. Lakukan di semua node yang ingin dipantau.\ncurl -s https://api.github.com/repos/grafana/loki/releases/latest | grep browser_download_url | cut -d \u0026#39;\u0026#34;\u0026#39; -f 4 | grep promtail-linux-amd64.zip | wget -i - unzip promtail-linux-amd64.zip mv promtail-linux-amd64 /usr/local/bin/promtail mkdir /etc/promtail Buat file konfigurasi promtail, Kita akan mengambil log di semua file yang mempunyai nama akhiran log.\nnano /etc/promtail/local-config.yaml #... server: http_listen_port: 9080 grpc_listen_port: 0 positions: filename: /tmp/positions.yaml clients: - url: http://172.18.251.30:3100/loki/api/v1/push scrape_configs: - job_name: oslog static_configs: - targets: - localhost labels: host: server1 __path__: /var/log/*log #... Buat service promtail.\nnano /etc/systemd/system/promtail.service #... [Unit] Description=Promtail service After=network.target [Service] Type=simple User=root ExecStart=/usr/local/bin/promtail -config.file /etc/promtail/local-config.yaml [Install] WantedBy=multi-user.target #... Restart service promtail.\nsystemctl daemon-reload systemctl enable promtail.service systemctl restart promtail.service systemctl status promtail.service Cek versi promtail.\npromtail --version Cek listen port promtail.\nss -tunlp |grep 9080 Install Loki Download package loki.\ncurl -s https://api.github.com/repos/grafana/loki/releases/latest | grep browser_download_url | cut -d \u0026#39;\u0026#34;\u0026#39; -f 4 | grep loki-linux-amd64.zip | wget -i - unzip loki-linux-amd64.zip mv loki-linux-amd64 /usr/local/bin/loki mkdir /data_loki/loki mkdir /etc/loki Buat file konfigurasi loki.\nnano /etc/loki/local-config.yaml #... auth_enabled: false server: http_listen_port: 3100 ingester: lifecycler: address: 172.18.251.30 ring: kvstore: store: inmemory replication_factor: 1 final_sleep: 0s chunk_idle_period: 5m chunk_retain_period: 30s max_transfer_retries: 0 schema_config: configs: - from: 2023-05-30 store: boltdb object_store: filesystem schema: v11 index: prefix: index_ period: 168h storage_config: boltdb: directory: /data_loki/loki/index filesystem: directory: /data_loki/loki/chunks limits_config: enforce_metric_name: false reject_old_samples: true reject_old_samples_max_age: 168h ingestion_rate_mb: 30 ingestion_burst_size_mb: 30 max_entries_limit_per_query: 50000000000 chunk_store_config: max_look_back_period: 0s table_manager: retention_deletes_enabled: false retention_period: 0s #... Buat service loki.\nnano /etc/systemd/system/loki.service #... [Unit] Description=Loki service After=network.target [Service] Type=simple User=root ExecStart=/usr/local/bin/loki -config.file /etc/loki/local-config.yaml [Install] WantedBy=multi-user.target #... Restart service loki.\nsystemctl daemon-reload systemctl restart loki.service systemctl enable loki.service systemctl status loki.service Cek versi loki.\nloki --version Cek listen port loki.\nss -tunlp |grep 3100 Untuk install grafana bisa lihat di artikel berikut install-grafana.\n","permalink":"https://opstekel.github.io/posts/grafana-loki/","summary":"Topologi Penjelasan Promtail: Agen pengumpul log dari berbagai sumber seperti file teks, syslog, dan jurnal sistem kemudian mengirimkannya ke penyimpanan log yang disebut loki. Install promtail di setiap node atau vm yang ingin dipantau.\nLoki: Penyimpanan log yang dirancang untuk menyimpan dan mengindeks log secara efisien. Loki menggunakan struktur penyimpanan berbasis waktu yang disebut \u0026ldquo;index\u0026rdquo; dan \u0026ldquo;chunk\u0026rdquo;. Log yang dikumpulkan oleh promtail dikirim ke loki untuk disimpan.\nGrafana: berfungsi sebagai visualisasi jika ingin memonitoring jumlah log ataupun ingin menggunakan fitur grafana alert agar ketika ada log error maka akan mengirimkan notifikasi (optional).","title":"Install Promtail Loki"},{"content":"Prasyarat Mempunyai Ceph Cluster Enable Plugin Prometheus Enable plugin prometheus di node cluster ceph, lakukan di salah satu ceph-mon node nya saja.\nceph mgr module enable prometheus --force Lakukan pengecekan expose ceph metric di IP dan Port berapa.\nceph mgr services Cek listen port ceph exporter.\nss -tunlp |grep 9283 Cek metrics.\ncurl http://ip-ceph:9283/metrics Integrasi Ceph Exporter dengan Prometheus Tambahkan job ceph exporter di prometheus.\nnano /etc/prometheus/prometheus.yml #... global: scrape_interval: 15s evaluation_interval: 15s scrape_timeout: 10s scrape_configs: # Tambahkan line dibawah ini - job_name: \u0026#34;ceph-exporter\u0026#34; scrape_interval: 15s honor_timestamps: true scrape_timeout: 10s scheme: http metrics_path: /metrics static_configs: - targets: - ip-ceph1:9283 - ip-ceph2:9283 - ip-ceph3:9283 labels: alias: ceph-exporter #... Note:\nJika menggunakan 3 ceph monitor maka masukkan saja ketiga ip ceph mon tersebut ke dalam konfigurasi prometheus, karena yang menjadi leader dari ceph mon tidak tetap di satu ceph mon node saja (berpindah-pindah).\nLakukan pengecekan apakah metric ceph sudah bisa di query dari prometheus dashboard.\nCustom IP dan Port Ceph Exporter ceph config set mgr mgr/prometheus/server_addr \u0026lt;ip-address\u0026gt; ceph config set mgr mgr/prometheus/server_port \u0026lt;port\u0026gt; Contoh:\nceph config set mgr mgr/prometheus/server_addr 0.0.0.0 ceph config set mgr mgr/prometheus/server_port 9283 ","permalink":"https://opstekel.github.io/posts/expose-ceph-metrics/","summary":"Prasyarat Mempunyai Ceph Cluster Enable Plugin Prometheus Enable plugin prometheus di node cluster ceph, lakukan di salah satu ceph-mon node nya saja.\nceph mgr module enable prometheus --force Lakukan pengecekan expose ceph metric di IP dan Port berapa.\nceph mgr services Cek listen port ceph exporter.\nss -tunlp |grep 9283 Cek metrics.\ncurl http://ip-ceph:9283/metrics Integrasi Ceph Exporter dengan Prometheus Tambahkan job ceph exporter di prometheus.\nnano /etc/prometheus/prometheus.yml #... global: scrape_interval: 15s evaluation_interval: 15s scrape_timeout: 10s scrape_configs: # Tambahkan line dibawah ini - job_name: \u0026#34;ceph-exporter\u0026#34; scrape_interval: 15s honor_timestamps: true scrape_timeout: 10s scheme: http metrics_path: /metrics static_configs: - targets: - ip-ceph1:9283 - ip-ceph2:9283 - ip-ceph3:9283 labels: alias: ceph-exporter #.","title":"Expose Ceph Metrics"},{"content":"Topologi Pendahuluan Ping exporter adalah aplikasi yang digunakan untuk mengukur kualitas jaringan dan mengumpulkan statistik ping dari berbagai host atau perangkat. Ping exporter biasanya digunakan untuk melakukan monitoring konektifitas pada jaringan apakah terjadi ping loss (putus koneksi) ataupun untuk memonitor latency jaringan.\nInstall Ping Exporter Download package ping exporter di node ping exporter (172.18.251.12).\nwget https://github.com/czerwonk/ping_exporter/releases/download/1.0.1/ping_exporter_1.0.1_linux_amd64.tar.gz tar xvf ping_exporter_1.0.1_linux_amd64.tar.gz cp ping_exporter /usr/local/bin/ Buat file konfigurasi ping exporter.\nmkdir /etc/ping_exporter/config.yml #... targets: - 172.18.251.11 ping: interval: 2s timeout: 3s history-size: 42 size: 120 #... Buat service ping exporter.\nnano /etc/systemd/system/ping_exporter.service #... [Unit] Description=Ping Exporter After=network.target [Service] User=root ExecStart=/usr/local/bin/ping_exporter --config.path=/etc/ping_exporter/config.yml NoNewPrivileges=yes CapabilityBoundingSet=CAP_NET_RAW AmbientCapabilities=CAP_NET_RAW PrivateDevices=true PrivateTmp=yes ProtectControlGroups=true ProtectKernelModules=yes ProtectKernelTunables=true ProtectSystem=strict ProtectClock=true ProtectHostname=true ProtectHome=true DevicePolicy=closed RestrictNamespaces=yes RestrictRealtime=yes RestrictSUIDSGID=yes MemoryDenyWriteExecute=yes LockPersonality=yes Restart=always RestartSec=3 [Install] WantedBy=default.target #... Restart service ping exporter.\nsystemctl daemon-reload systemctl restart ping_exporter.service systemctl enable ping_exporter.service systemctl status ping_exporter.service Cek listen port ping exporter.\nss -tunlp |grep 9427 Cek metric-metric ping exporter.\ncurl 172.18.251.12:9427/metrics Integrasi ping exporter dengan prometheus Tambahkan job ping exporter di node prometheus.\nglobal: scrape_interval: 15s evaluation_interval: 15s scrape_timeout: 10s scrape_configs: ## Tambahkan line di bawah ini. - job_name: \u0026#34;ping-exporter\u0026#34; static_configs: - targets: - 172.18.251.12:9427 Restart service prometheus.\nsystemctl restart prometheus.service Verifikasi Lakukan pengecekan pada dashboard prometheus apakah metric ping exporter sudah masuk ke prometheus.\n","permalink":"https://opstekel.github.io/posts/ping-exporter/","summary":"Topologi Pendahuluan Ping exporter adalah aplikasi yang digunakan untuk mengukur kualitas jaringan dan mengumpulkan statistik ping dari berbagai host atau perangkat. Ping exporter biasanya digunakan untuk melakukan monitoring konektifitas pada jaringan apakah terjadi ping loss (putus koneksi) ataupun untuk memonitor latency jaringan.\nInstall Ping Exporter Download package ping exporter di node ping exporter (172.18.251.12).\nwget https://github.com/czerwonk/ping_exporter/releases/download/1.0.1/ping_exporter_1.0.1_linux_amd64.tar.gz tar xvf ping_exporter_1.0.1_linux_amd64.tar.gz cp ping_exporter /usr/local/bin/ Buat file konfigurasi ping exporter.\nmkdir /etc/ping_exporter/config.yml #... targets: - 172.","title":"Install Ping Exporter"},{"content":"Prasyarat Sudah terinstall prometheus dan grafana.\nMempunyai akun slack.\nBaca juga:\nInstall Prometheus dan Grafana\nInstall Alertmanager\nSetting Slack Klik workspace name.\nSettings \u0026amp; administration -\u0026gt; Manage apps.\nSearch Incoming WebHooks.\nAdd to slack.\nPilih channel -\u0026gt; Add Incoming WebHooks integration.\nNote:\nchannel disini hanya pilihan saja, nanti kita tetap bisa menentukan tujuan channel di slack menggunakan grafana.\nCopy Webhook URL\nSetting Grafana. Disini kita akan mencoba mengirim notifikasi alert ke beberapa channel di slack menggunakan 1 webhook url.\nLogin Dashboard grafana.\nContact points -\u0026gt; Add contact point\nSet Integration ke slack -\u0026gt; set channel pada bagian Recipient -\u0026gt; paste webhook URL -\u0026gt; kemudian test kirim.\nAlert firing masuk ke channel yang kita setting.\nCoba lagi test kirim notifikasi dengan webhook url yang sama tapi dengan channel yang berbeda.\nMaka alert firing masuk ke channel yang kita setting.\n","permalink":"https://opstekel.github.io/posts/send-alert-ke-slack/","summary":"Prasyarat Sudah terinstall prometheus dan grafana.\nMempunyai akun slack.\nBaca juga:\nInstall Prometheus dan Grafana\nInstall Alertmanager\nSetting Slack Klik workspace name.\nSettings \u0026amp; administration -\u0026gt; Manage apps.\nSearch Incoming WebHooks.\nAdd to slack.\nPilih channel -\u0026gt; Add Incoming WebHooks integration.\nNote:\nchannel disini hanya pilihan saja, nanti kita tetap bisa menentukan tujuan channel di slack menggunakan grafana.\nCopy Webhook URL\nSetting Grafana. Disini kita akan mencoba mengirim notifikasi alert ke beberapa channel di slack menggunakan 1 webhook url.","title":"Mengirim Notifikasi Alert Grafana ke Slack"},{"content":"Prasyarat Sudah terinstall prometheus dan grafana. Baca juga:\nInstall Prometheus dan Grafana\nInstall Alertmanager\nSetting Contact Point Setting contact point di dashboard grafana. Email address yang di isi pada contact point merupakan email address tujuan.\nSetting SMTP Tambahkan SMTP section pada konfigurasi file grafana.\nnano /etc/grafana/grafana.ini #... # Setting di bawah section [smtp] enabled = true host = smtp.gmail.com:587 user = your-email@gmail.com password = kdnjfoctswrpyanx from_address = your-email@gmail.com from_name = ginton #... Catatan:\nhost = mengirim notifikasi ke email menggunakan port 587\nuser = merupakan email address pengirim\npassword = merupakan password user email your-email@gmail.com dari setelah generate app password di settingan gmail\nGenerate password.\nAccount -\u0026gt; Manage your Google Account.\nSecurity.\n2-Step Verification and Scroll Down.\nApp passwords.\nselect app: Other (Custom name).\nGenerate.\nCopy password dan paste di section password [smtp].\nRestart service grafana.\nsystemctl restart grafana-server.service Verifikasi Send test notification apakah sudah berhasil atau belum.\n","permalink":"https://opstekel.github.io/posts/send-alert-ke-email/","summary":"Prasyarat Sudah terinstall prometheus dan grafana. Baca juga:\nInstall Prometheus dan Grafana\nInstall Alertmanager\nSetting Contact Point Setting contact point di dashboard grafana. Email address yang di isi pada contact point merupakan email address tujuan.\nSetting SMTP Tambahkan SMTP section pada konfigurasi file grafana.\nnano /etc/grafana/grafana.ini #... # Setting di bawah section [smtp] enabled = true host = smtp.gmail.com:587 user = your-email@gmail.com password = kdnjfoctswrpyanx from_address = your-email@gmail.com from_name = ginton #.","title":"Mengirim Notifikasi Alert Grafana ke Email"},{"content":"Pendahuluan Jika ingin notifikasi yang dikirim disertai dengan screenshot dari panel dashboard kita bisa mengaktifkannya dengan enable image renderer pada grafana. Perintah ini di jalankan di node grafana.\nEnable Image Renderer Plugin Enable grafana image renderer plugin dengan menggunakan command.\ngrafana-cli plugins install grafana-image-renderer Tambahkan section dibawah ke dalam file konfigurasi grafana.\nnano /etc/grafana/grafana.ini #... # Tambahkan line dibawah ini [unified_alerting.screenshots] capture = true #... Install dependencies untuk menjalankan fungsi image renderer.\nUbuntu:\napt install libx11-6 libx11-xcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrender1 libxtst6 libglib2.0-0 libnss3 libcups2 libdbus-1-3 libxss1 libxrandr2 libgtk-3-0 libasound2 libxcb-dri3-0 libgbm1 libxshmfence1 Debian 9:\napt install libx11 libcairo libcairo2 libxtst6 libxcomposite1 libx11-xcb1 libxcursor1 libxdamage1 libnss3 libcups libcups2 libxss libxss1 libxrandr2 libasound2 libatk1.0-0 libatk-bridge2.0-0 libpangocairo-1.0-0 libgtk-3-0 libgbm1 libxshmfence1 Debian 10:\napt install libxdamage1 libxext6 libxi6 libxtst6 libnss3 libcups2 libxss1 libxrandr2 libasound2 libatk1.0-0 libatk-bridge2.0-0 libpangocairo-1.0-0 libpango-1.0-0 libcairo2 libatspi2.0-0 libgtk3.0-cil libgdk3.0-cil libx11-xcb-dev libgbm1 libxshmfence1 Centos 7:\napt install libXcomposite libXdamage libXtst cups libXScrnSaver pango atk adwaita-cursor-theme adwaita-icon-theme at at-spi2-atk at-spi2-core cairo-gobject colord-libs dconf desktop-file-utils ed emacs-filesystem gdk-pixbuf2 glib-networking gnutls gsettings-desktop-schemas gtk-update-icon-cache gtk3 hicolor-icon-theme jasper-libs json-glib libappindicator-gtk3 libdbusmenu libdbusmenu-gtk3 libepoxy liberation-fonts liberation-narrow-fonts liberation-sans-fonts liberation-serif-fonts libgusb libindicator-gtk3 libmodman libproxy libsoup libwayland-cursor libwayland-egl libxkbcommon m4 mailx nettle patch psmisc redhat-lsb-core redhat-lsb-submod-security rest spax time trousers xdg-utils xkeyboard-config alsa-lib Centos 8:\napt install libXcomposite libXdamage libXtst cups libXScrnSaver pango atk adwaita-cursor-theme adwaita-icon-theme at at-spi2-atk at-spi2-core cairo-gobject colord-libs dconf desktop-file-utils ed emacs-filesystem gdk-pixbuf2 glib-networking gnutls gsettings-desktop-schemas gtk-update-icon-cache gtk3 hicolor-icon-theme jasper-libs json-glib libappindicator-gtk3 libdbusmenu libdbusmenu-gtk3 libepoxy liberation-fonts liberation-narrow-fonts liberation-sans-fonts liberation-serif-fonts libgusb libindicator-gtk3 libmodman libproxy libsoup libwayland-cursor libwayland-egl libxkbcommon m4 mailx nettle patch psmisc redhat-lsb-core redhat-lsb-submod-security rest spax time trousers xdg-utils xkeyboard-config alsa-lib libX11-xcb Buat alert seperti referensi berikut Create Alert\nKemudian test shutdown node atau vm.\nshutdown -h now maka notifikasi juga akan mengirimkan screenshot gambar dari panel dashboard.\n","permalink":"https://opstekel.github.io/posts/enable-image-renderer/","summary":"Pendahuluan Jika ingin notifikasi yang dikirim disertai dengan screenshot dari panel dashboard kita bisa mengaktifkannya dengan enable image renderer pada grafana. Perintah ini di jalankan di node grafana.\nEnable Image Renderer Plugin Enable grafana image renderer plugin dengan menggunakan command.\ngrafana-cli plugins install grafana-image-renderer Tambahkan section dibawah ke dalam file konfigurasi grafana.\nnano /etc/grafana/grafana.ini #... # Tambahkan line dibawah ini [unified_alerting.screenshots] capture = true #... Install dependencies untuk menjalankan fungsi image renderer.","title":"Mengirim Notifikasi dengan Screenshot Image Dashboard"},{"content":"Add Datasource Toggle Menu -\u0026gt; Administrations -\u0026gt; Data Sources -\u0026gt; Add new data source -\u0026gt; prometheus.\nTambahkan data source prometheus dengan IP node prometheus.\nCreate Dashboard Toggle Menu -\u0026gt; Dashboards -\u0026gt; Go To Folder -\u0026gt; Create Dashboard -\u0026gt; Add Visualization\nEdit dashboard seperti gambar dibawah (total node yang aktif) lalu save.\nCreate Alert Membuat alert ketika ada node yang tidak aktif maka akan mengirim notifikasi ke telegram.\nStep 1: Create alert pada panel dashboard.\nBuat rule B untuk mengambil nilai terakhir dari rule A. Kemudian rule C untuk menentukan jika nilai dari node yang up (rule B) kurang dari 2 maka ada node down yang akan trigger alert untuk mengirimkan notifikasi.\nevaluation interval berfungsi untuk melakukan pengecekan aturan rule secara berkala apakah memenuhi kondisi atau tidak. Jika diatur evaluation interval ke 1 menit, grafana akan memeriksa kondisi alert setiap menit.\nfor 2m adalah untuk menentukan berapa lama suatu kondisi harus dipertahankan sebelum alert dikirimkan, Jika diatur for selama 2m maka kondisi nilai akan dipertahankan selama 2 menit jika benar selama 2 menit kondisi nya memenuhi kondisi alert maka akan mengirim notifikasi ke telegram. for digunakan untuk menghilangkan pemberitahuan palsu atau flapping (pemberitahuan yang berulang kali dikirimkan secara berulang dalam periode waktu yang singkat) yang dapat terjadi ketika metrik melonjak naik dan turun dengan cepat.\nlabels juga penting untuk notification policies tau bahwa alert rule mana akan dikirimkan kemana.\nStep 2: Buat contact points ke telegram. Isikan token bot API telegram dan chat ID telegram.\nNote: untuk mencari chat ID telegram bisa dengan: https://api.telegram.org/bot(token)/getUpdates\nStep 3: Buat notification policies, isi label sesuai dengan label di alert rule dan pilih contact points yang sudah kita buat.\nVerifikasi Matikan salah satu instance atau vm node exporter.\nshutdown -h now Periksa kembali 1 sampai 2 menit status alert rule akan berubah menjadi pending kemudian firing.\nKemudian mengirimkan notifikasi ke telegram.\n","permalink":"https://opstekel.github.io/posts/membuat-dashboard-dan-alert/","summary":"Add Datasource Toggle Menu -\u0026gt; Administrations -\u0026gt; Data Sources -\u0026gt; Add new data source -\u0026gt; prometheus.\nTambahkan data source prometheus dengan IP node prometheus.\nCreate Dashboard Toggle Menu -\u0026gt; Dashboards -\u0026gt; Go To Folder -\u0026gt; Create Dashboard -\u0026gt; Add Visualization\nEdit dashboard seperti gambar dibawah (total node yang aktif) lalu save.\nCreate Alert Membuat alert ketika ada node yang tidak aktif maka akan mengirim notifikasi ke telegram.\nStep 1: Create alert pada panel dashboard.","title":"Membuat Dashboard dan Mengirim Notifikasi ke Telegram"},{"content":"Pendahuluan AlertManager adalah salah satu komponen utama dalam sistem pemantauan prometheus. Prometheus digunakan untuk mengumpulkan dan menyimpan metrik real time dari sistem yang sedang dimonitoring, sementara alertmanager bertanggung jawab untuk mengelola dan mengirimkan notifikasi atau peringatan (alert) berdasarkan kondisi tertentu.\nAlertManager bisa di install di node terpisah dengan prometheus dan grafana, namun pada contoh ini alertmanager di install di node prometheus dan grafana. Sebelum melanjutkan lebih baik membaca terlebih dahulu install-prometheus-grafana\nInstall AlertManager Download dan install alertmanager.\nwget https://github.com/prometheus/alertmanager/releases/download/v0.25.0/alertmanager-0.25.0.linux-amd64.tar.gz tar xvf alertmanager-0.25.0.linux-amd64.tar.gz cd alertmanager-0.25.0.linux-amd64/ mkdir /etc/alertmanager cp alertmanager.yml /etc/alertmanager/ cp alertmanager amtool /usr/local/bin/ Buat service alertmanager.\nnano /etc/systemd/system/alertmanager.service #... [Unit] Description=AlertManager Server Service Wants=network-online.target After=network-online.target [Service] User=root Group=root Type=simple ExecStart=/usr/local/bin/alertmanager --config.file /etc/alertmanager/alertmanager.yml --web.external-url=http://\u0026lt;ip-node-alertmanager\u0026gt;:9093 [Install] WantedBy=multi-user.target #... Edit file konfigurasi alertmanager\nnano /etc/alertmanager/alertmanager.yml #... global: resolve_timeout: 5m route: group_by: [\u0026#39;alertname\u0026#39;] receiver: slack_general routes: - match: severity: slack receiver: slack_general receivers: - name: slack_general slack_configs: # Setting slack agar enable incoming webhooks dan copy url ke bawah ini (optional). - api_url: \u0026#39;https://hooks.slack.com/services/\u0026lt;incoming-web-hooks-service\u0026gt;\u0026#39; channel: \u0026#39;#alert\u0026#39; icon_url: https://avatars3.githubusercontent.com/u/3380462 title: |- [{{ .Status | toUpper }}{{ if eq .Status \u0026#34;firing\u0026#34; }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .CommonLabels.alertname }} for {{ .CommonLabels.job }} {{- if gt (len .CommonLabels) (len .GroupLabels) -}} {{\u0026#34; \u0026#34;}}( {{- with .CommonLabels.Remove .GroupLabels.Names }} {{- range $index, $label := .SortedPairs -}} {{ if $index }}, {{ end }} {{- $label.Name }}=\u0026#34;{{ $label.Value -}}\u0026#34; {{- end }} {{- end -}} ) {{- end }} text: \u0026gt;- {{ range .Alerts -}} *Alert:* {{ .Annotations.title }}{{ if .Labels.severity }} - `{{ .Labels.severity }}`{{ end }} *Description:* {{ .Annotations.description }} *Details:* {{ range .Labels.SortedPairs }} • *{{ .Name }}:* `{{ .Value }}` {{ end }} {{ end }} inhibit_rules: - source_match: severity: \u0026#39;critical\u0026#39; target_match: severity: \u0026#39;warning\u0026#39; equal: [\u0026#39;alertname\u0026#39;, \u0026#39;dev\u0026#39;, \u0026#39;instance\u0026#39;] #... Restart service alertmanager.\nsystemctl daemon-reload systemctl restart alertmanager.service systemctl enable alertmanager.service systemctl status alertmanager.service Cek listen port alertmanager\nss -tunlp |grep 9093 Akses dashboard alertmanager, ip-alertmanager:9093.\nIntegrasi alertmanager dengan prometheus. Kita perlu menambahkan alerting di konfigurasi prometheus.\nDi node prometheus, tambahkan:\nnano /etc/prometheus/prometheus.yml #... global: scrape_interval: 15s evaluation_interval: 15s scrape_timeout: 10s # Tambahkan line di bawah ini alerting: alertmanagers: - static_configs: - targets: - 172.18.251.30:9093 #... Restart service prometheus.\nsystemctl restart prometheus.service ","permalink":"https://opstekel.github.io/posts/install-alertmanager/","summary":"Pendahuluan AlertManager adalah salah satu komponen utama dalam sistem pemantauan prometheus. Prometheus digunakan untuk mengumpulkan dan menyimpan metrik real time dari sistem yang sedang dimonitoring, sementara alertmanager bertanggung jawab untuk mengelola dan mengirimkan notifikasi atau peringatan (alert) berdasarkan kondisi tertentu.\nAlertManager bisa di install di node terpisah dengan prometheus dan grafana, namun pada contoh ini alertmanager di install di node prometheus dan grafana. Sebelum melanjutkan lebih baik membaca terlebih dahulu install-prometheus-grafana","title":"Install AlertManager"},{"content":"Topologi Install Node Exporter Node exporter adalah aplikasi yang digunakan untuk mengekspor metrik dari sebuah sistem atau node ke dalam format yang dapat digunakan oleh sistem monitoring seperti prometheus. Node exporter berfungsi sebagai agen yang diinstall pada setiap node atau VM yang ingin di monitoring.\nBuat user node_exporter untuk menjalankan service node exporter.\nuseradd --no-create-home --shell /bin/false node_exporter Download dan install packages node exporter.\nwget https://github.com/prometheus/node_exporter/releases/download/v1.5.0/node_exporter-1.5.0.linux-amd64.tar.gz tar xvf node_exporter-1.5.0.linux-amd64 cd node_exporter-1.5.0.linux-amd64/ chown node_exporter:node_exporter node_exporter cp node_exporter /usr/local/bin/ Untuk melihat collectors node exporter jalankan.\nroot@lab-node-exporter-1:~# node_exporter Buat service node exporter.\nnano /etc/systemd/system/node_exporter.service #... [Unit] Description=Node Exporter [Service] User=node_exporter Type=simple ExecStart=/usr/local/bin/node_exporter --collector.systemd --collector.cpu --collector.meminfo --collector.loadavg --collector.uname \\ --collector.stat --collector.filesystem --collector.netstat Restart=on-failure RestartSec=5 [Install] WantedBy=multi-user.target #... Restart service node exporter.\nsystemd daemon-reload systemctl restart node_exporter.service systemctl enable node_exporter.service systemctl status node_exporter.service Cek listen port dari node exporter.\nss -tunlp |grep 9100 Check metrics node exporter.\ncurl http://\u0026lt;ip-node-exporter\u0026gt;:9100/metrics Install Prometheus Prometheus adalah sistem monitoring open source yang dirancang khusus untuk memantau dan mengumpulkan data metrik dari berbagai sistem dan layanan.\nBuat user prometheus untuk menjalankan service prometheus.\nuseradd --no-create-home --shell /bin/false prometheus Download dan installl packages prometheus.\nwget https://github.com/prometheus/prometheus/releases/download/v2.44.0/prometheus-2.44.0.linux-amd64.tar.gz tar xvf prometheus-2.44.0.linux-amd64.tar.gz cd prometheus-2.44.0.linux-amd64/ chown -r prometheus:prometheus prometheus promtool console_libraries consoles prometheus.yml cp prometheus promtool /usr/local/bin mkdir /var/lib/prometheus mkdir /etc/prometheus cp -r console_libraries console prometheus.yml /etc/prometheus/ Edit file konfigurasi prometheus.\nnano /etc/prometheus/prometheus.yml #... global: scrape_interval: 15s evaluation_interval: 15s scrape_timeout: 10s scrape_configs: - job_name: \u0026#34;prometheus\u0026#34; metrics_path: /metrics scheme: http honor_timestamps: true static_configs: - targets: [\u0026#34;172.18.251.30:9090\u0026#34;] - job_name: \u0026#34;node-exporter\u0026#34; metrics_path: /metrics scheme: http honor_timestamps: true static_configs: - targets: - 172.18.251.11:9100 - 172.18.251.12:9100 #... Buat service prometheus.\nnano /etc/systemd/system/prometheus/prometheus.service #... [Unit] Description=Prometheus Server [Service] User=prometheus Group=prometheus Type=simple ExecStart=/usr/local/bin/prometheus --config.file=/etc/prometheus/prometheus.yml \\ --storage.tsdb.path=/var/lib/prometheus/ --web.external-url=http://172.18.251.30:9090 --storage.tsdb.max-block-duration=2h \\ --storage.tsdb.min-block-duration=2h --storage.tsdb.retention.time=365d --storage.tsdb.wal-compression --web.enable-lifecycle \\ --web.enable-admin-api --log.level=debug --web.console.templates=/etc/prometheus/consoles --web.console.libraries=/etc/prometheus/console_libraries [Install] WantedBy=multi-user.target #... Lakukan pengecekan apakah konfigurasi file prometheus sudah valid.\npromtool check config /etc/prometheus/prometheus.yml Restart service prometheus.\nsystemctl daemon-reload systemctl restart prometheus.service systemctl enable prometheus.service systemctl status prometheus.service Cek versi prometeheus.\npromtool --version Cek listen port prometheus.\nss -tunlp |grep 9090 Apakah ada jobs yang running.\npromtool query instant \u0026#39;http://\u0026lt;ip-prometheus\u0026gt;:9090\u0026#39; \u0026#39;up==1\u0026#39; Akses dashboard prometheus.\nInstall Grafana Grafana adalah software open source yang digunakan untuk membuat visualisasi atau dashboard monitoring dari metrics yang sudah di kumpulkan oleh prometheus.\nInstall dependencies packages grafana.\napt update apt-get install -y gnupg2 curl software-properties-common Tambahkan repository.\ncurl https://packages.grafana.com/gpg.key | sudo apt-key add - add-apt-repository \u0026#34;deb https://packages.grafana.com/oss/deb stable main\u0026#34; apt update Install grafana.\napt-cache policy grafana apt -y install grafana=9.5.2 Restart service grafana.\nsystemctl enable grafana-server.service systemctl restart grafana-server.service systemctl status grafana-server.service Cek versi grafana.\ngrafana-cli --version Cek listen port grafana.\nss -tunlp |grep 3000 Akses dashboard grafana.\n","permalink":"https://opstekel.github.io/posts/install-prometheus-grafana/","summary":"Topologi Install Node Exporter Node exporter adalah aplikasi yang digunakan untuk mengekspor metrik dari sebuah sistem atau node ke dalam format yang dapat digunakan oleh sistem monitoring seperti prometheus. Node exporter berfungsi sebagai agen yang diinstall pada setiap node atau VM yang ingin di monitoring.\nBuat user node_exporter untuk menjalankan service node exporter.\nuseradd --no-create-home --shell /bin/false node_exporter Download dan install packages node exporter.\nwget https://github.com/prometheus/node_exporter/releases/download/v1.5.0/node_exporter-1.5.0.linux-amd64.tar.gz tar xvf node_exporter-1.5.0.linux-amd64 cd node_exporter-1.","title":"Install Prometheus dan Grafana"}]